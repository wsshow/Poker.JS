<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>poker</title>
</head>

<body>
    <div id="container" style="margin-top: 30px;">
    </div>
</body>
<style>
    #container {
        position: absolute;
        bottom: 0;
    }

    .card-selected {
        transform: translateY(-16px);
    }

    .unselectable {
        -moz-user-select: -moz-none;
        -khtml-user-select: none;
        -webkit-user-select: none;
        -o-user-select: none;
        user-select: none;
    }
</style>
<script src="../release/poker.min.js"></script>
<script>

    if (window.Poker) {

        class Card {
            constructor(point, suit, img, value) {
                this.Point = point;
                this.Suit = suit;
                this.Img = img;
                this.Value = value;
            }
        }

        let mapValue = {
            '3': 3,
            '4': 4,
            '5': 5,
            '6': 6,
            '7': 7,
            '8': 8,
            '9': 9,
            '10': 10,
            'j': 11,
            'q': 12,
            'k': 13,
            'a': 14,
            '2': 15,
            'jokers': 16,
            'jokerh': 17,
        }

        // 生成卡组
        console.time('GenerateCardTime');
        let suits = ['hearts', 'diamonds', 'spades', 'clubs'];
        let points = ['a', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'j', 'q', 'k'];
        let cards = []
        let point, suit, img, card;
        for (const ks in suits) {
            for (const kp in points) {
                point = points[kp]
                suit = suits[ks];
                img = Poker.getCardData(120, suit, point);
                card = new Card(point, suit, img, mapValue[point])
                cards.push(card)
            }
        }
        card = new Card('jokers', 'spades', Poker.getCardData(120, 'spades', 'joker'), mapValue['jokers'])
        cards.push(card)
        card = new Card('jokerh', 'hearts', Poker.getCardData(120, 'hearts', 'joker'), mapValue['jokerh'])
        cards.push(card)
        // cards.forEach(card => {
        //     console.log(card);
        // });
        console.log('cards length:', cards.length);
        console.timeEnd('GenerateCardTime');

        // 洗牌算法
        function Shuffle(arr) {
            let len = arr.length, random
            while (len != 0) {
                random = (Math.random() * len--) >>> 0;
                [arr[len], arr[random]] = [arr[random], arr[len]]
            }
            return arr
        }

        // 洗牌
        console.time('ShuffleTime');
        cards = Shuffle(cards)
        console.timeEnd('ShuffleTime');

        // 展示卡组
        let container = document.getElementById('container');
        let nodeImg, bLeftMouseDown = false;
        let cards_A = cards.slice(0, 16);
        cards_A = cards_A.sort((a, b) => {
            return b.Value - a.Value;
        });
        // 选择卡片动作
        function SelectedCard(e) {
            if (e.target.classList.contains('card-selected')) {
                e.target.classList.remove('card-selected')
            } else {
                e.target.classList.add('card-selected')
            }
        }
        for (const k in cards_A) {
            card = cards_A[k]
            nodeImg = document.createElement("img");
            if (k != 0) {
                nodeImg.style.marginLeft = '-65px';
                nodeImg.style.position = 'relative';
                nodeImg.style.zIndex = k;
            }
            nodeImg.src = card.Img;
            nodeImg.title = card.Point + '-' + card.Suit;
            nodeImg.value = card.Value;
            nodeImg.onclick = (e) => {
                SelectedCard(e);
            }
            nodeImg.onmouseenter = (e) => {
                if (bLeftMouseDown) {
                    SelectedCard(e);
                }
            };
            // 禁止图片选中或拖动
            nodeImg.draggable = false;
            nodeImg.classList.add('unselectable');
            container.appendChild(nodeImg)
        }

        document.onmousedown = (e) => {
            bLeftMouseDown = true;
        }
        document.onmouseup = (e) => {
            bLeftMouseDown = false;
        }
        // 禁止全局右键菜单
        document.oncontextmenu = () => false;
    } else {
        document.body.innerHTML = 'This browser does not support canvas.';
    }


</script>

</html>